<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finans Takipçisi</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-wallet"></i>
                <h2>Finansım</h2>
            </div>
            <nav>
                <button class="nav-btn active" onclick="showTab('dashboard')"><i class="fas fa-home"></i>
                    <span>Özet</span></button>
                <button class="nav-btn" onclick="showTab('assets')"><i class="fas fa-coins"></i>
                    <span>Varlıklarım</span></button>
                <button class="nav-btn" onclick="showTab('investments')"><i class="fas fa-chart-pie"></i>
                    <span>Yatırımlar</span></button>

                <button class="nav-btn" onclick="showTab('transactions')"><i class="fas fa-exchange-alt"></i>
                    <span>Gelir/Gider</span></button>
                <button class="nav-btn" onclick="showTab('market')"><i class="fas fa-chart-line"></i>
                    <span>Piyasa</span></button>
                <button class="nav-btn" onclick="showTab('converter')"><i class="fas fa-calculator"></i>
                    <span>Çevirici</span></button>
            </nav>
        </aside>

        <main class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <header>
                    <h1>Hoş Geldiniz</h1>
                    <div class="year-selector-container">
                        <select id="yearSelect" class="year-select">
                            <!-- JS ile doldurulacak -->
                        </select>
                    </div>
                </header>

                <div class="stats-grid">
                    <div class="stat-card total-wealth">
                        <h3>Toplam Varlık</h3>
                        <p class="amount" id="totalWealth">₺0.00</p>
                    </div>
                    <div class="stat-card income">
                        <h3>Yıllık Gelir</h3>
                        <p class="amount" id="periodIncome">₺0.00</p>
                    </div>
                    <div class="stat-card expense">
                        <h3>Yıllık Gider</h3>
                        <p class="amount" id="periodExpense">₺0.00</p>
                    </div>
                </div>

                <!-- Portfolio Profit/Loss Section -->
                <div class="portfolio-summary-card">
                    <h3><i class="fas fa-chart-line"></i> Varlık Kar/Zarar Durumu</h3>
                    <div class="pl-container">
                        <p class="amount" id="periodProfitLoss">₺0.00</p>
                        <small id="plPercentage">(%0.00)</small>
                    </div>
                </div>

                <div id="monthlySummary" class="monthly-summary-section">
                    <h3>Aylık Döküm</h3>
                    <div class="table-responsive">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Ay</th>
                                    <th>Gelir</th>
                                    <th>Gider</th>
                                    <th>Net</th>
                                </tr>
                            </thead>
                            <tbody id="monthlySummaryBody">
                                <!-- JS ile doldurulacak -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assets Tab -->
            <div id="assets" class="tab-content">
                <header>
                    <h1>Varlıklarım</h1>
                    <button class="btn-primary" onclick="openModal('assetModal')"><i class="fas fa-plus"></i> Varlık
                        Ekle</button>
                </header>

                <div class="assets-grid" id="assetsList">
                    <!-- JS ile doldurulacak -->
                </div>
            </div>

            <!-- Investments Tab -->
            <div id="investments" class="tab-content">
                <header>
                    <h1>Yatırım Portföyü</h1>
                </header>

                <!-- Active Portfolio Section -->
                <div class="investment-section">
                    <h3><i class="fas fa-seedling"></i> Aktif Varlıklar (Kar/Zarar Durumu)</h3>
                    <div class="table-responsive">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Varlık</th>
                                    <th>Miktar</th>
                                    <th>Ort. Maliyet</th>
                                    <th>Güncel Fiyat</th>
                                    <th>Kar/Zarar</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="activePortfolioBody">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Trade History Section -->
                <div class="investment-section" style="margin-top: 30px;">
                    <h3><i class="fas fa-history"></i> Geçmiş İşlemler (Al/Sat)</h3>
                    <div class="table-responsive">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Varlık</th>
                                    <th>Alış Tarihi</th>
                                    <th>Satış Tarihi</th>
                                    <th>Alış Fiyatı</th>
                                    <th>Satış Fiyatı</th>
                                    <th>Gerçekleşen Kar/Zarar</th>
                                </tr>
                            </thead>
                            <tbody id="tradeHistoryBody">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content">
                <header>
                    <h1>Gelir ve Giderler</h1>
                    <button class="btn-primary" onclick="openModal('transactionModal')"><i class="fas fa-plus"></i>
                        İşlem Ekle</button>
                </header>

                <div class="transactions-list" id="transactionsList">
                    <!-- JS ile doldurulacak -->
                </div>
            </div>

            <!-- Market Tab -->
            <div id="market" class="tab-content">
                <header>
                    <h1>Canlı Piyasa</h1>
                    <button class="btn-primary" onclick="refreshMarketData()"><i class="fas fa-sync-alt"></i>
                        Yenile</button>
                </header>
                <div class="market-grid" id="marketList">
                    <!-- JS ile doldurulacak -->
                </div>
                <div class="last-update">
                    <small>Son Güncelleme: <span id="lastUpdate">...</span></small>
                </div>
            </div>

            <!-- Converter Tab -->
            <div id="converter" class="tab-content">
                <header>
                    <h1>Döviz Çevirici</h1>
                </header>
                <div class="converter-card">
                    <div class="form-group">
                        <label>Miktar</label>
                        <input type="number" id="convAmount" value="1" oninput="calculateConversion()">
                    </div>
                    <div class="converter-row">
                        <div class="form-group">
                            <label>Şundan</label>
                            <select id="convFrom" onchange="calculateConversion()">
                                <option value="TRY">Türk Lirası (TRY)</option>
                                <option value="USD" selected>Dolar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="GA">Gram Altın</option>
                            </select>
                        </div>
                        <i class="fas fa-arrow-right converter-arrow"></i>
                        <div class="form-group">
                            <label>Şuna</label>
                            <select id="convTo" onchange="calculateConversion()">
                                <option value="TRY" selected>Türk Lirası (TRY)</option>
                                <option value="USD">Dolar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="GA">Gram Altın</option>
                            </select>
                        </div>
                    </div>
                    <div class="result-box">
                        <h3>Sonuç:</h3>
                        <p id="convResult">...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Asset Modal -->
    <div id="assetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('assetModal')">&times;</span>
            <h2>Yeni Varlık Ekle</h2>
            <form id="assetForm">
                <div class="form-group">
                    <label>Banka / Kurum</label>
                    <select id="assetBank" required>
                        <option value="hsbc">HSBC</option>
                        <option value="garanti">Garanti BBVA</option>
                        <option value="albaraka">Albaraka Türk</option>
                        <option value="other">Diğer / Cüzdan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Varlık Türü</label>
                    <select id="assetType" required onchange="toggleAssetFields()">
                        <option value="try">Türk Lirası (TL)</option>
                        <option value="gold">Altın (Gram)</option>
                        <option value="silver">Gümüş (Gram)</option>
                        <option value="usd">Dolar ($)</option>
                        <option value="eur">Euro (€)</option>
                        <option value="fund">Yatırım Fonu</option>
                        <option value="stock">Hisse Senedi</option>
                        <option value="crypto">Kripto Para</option>
                        <option value="other">Diğer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Miktar</label>
                    <input type="number" id="assetAmount" step="0.0001" required placeholder="Örn: 1.5">
                </div>
                <div class="form-group" id="assetPriceGroup">
                    <label>Alış Birim Fiyatı (TL)</label>
                    <input type="number" id="assetPrice" step="0.01" required placeholder="Örn: 2450">
                    <small>O tarihteki 1 birim fiyatı</small>
                </div>
                <div class="form-group">
                    <label>Alış Tarihi</label>
                    <input type="date" id="assetDate" required>
                </div>
                <button type="button" class="btn-submit" onclick="saveAsset()">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Sell Asset Modal -->
    <div id="sellModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sellModal')">&times;</span>
            <h2>Varlık Satışı</h2>
            <form id="sellForm">
                <p id="sellAssetName" style="margin-bottom: 20px; font-weight: bold;"></p>
                <div class="form-group">
                    <label>Satış Birim Fiyatı</label>
                    <input type="number" id="sellPrice" step="0.01" required placeholder="Kaça sattınız?">
                    <small>1 birim için satış fiyatı</small>
                </div>
                <!-- Hidden inputs to track what we are selling -->
                <input type="hidden" id="sellingAssetId">
                <button type="submit" class="btn-submit" style="background-color: #ef4444;">Satışı Onayla</button>
            </form>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('transactionModal')">&times;</span>
            <h2>Gelir/Gider Ekle</h2>
            <form id="transactionForm">
                <div class="form-group">
                    <label>İşlem Türü</label>
                    <div class="radio-group">
                        <label><input type="radio" name="transType" value="income" checked> Gelir</label>
                        <label><input type="radio" name="transType" value="expense"> Gider</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <input type="text" id="transCategory" required placeholder="Örn: Maaş, Market, Fatura">
                </div>
                <div class="form-group">
                    <label>Tutar (TL)</label>
                    <input type="number" id="transAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Tarih</label>
                    <input type="date" id="transDate" required>
                </div>
                <button type="button" class="btn-submit" onclick="saveTransaction()">Kaydet</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Config & Logic -->
    <script src="firebase-config.js"></script>
    <script src="app.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker error', err));
        }
    </script>
</body>

</html>